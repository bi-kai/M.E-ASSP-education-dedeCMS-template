if(!window.BQQWPALOAD){(function(am,t){var V="0",aq="1",o="2",w="4",A="20",h="0",O="1",af="2",T="0",D="1",B="0",Q="1",J="2",ak="0",p="1",W="2",ag="0",k="1";var l=2000,x=1000,I=2000,ao=2000,c=5000,v=15000,X=3600000,n=1000;var ac="kfu",m="pgv_pvi";var Z="is",K="ik",S="msg",ai="mh",U="mid",av="slid";var aa="0",b="1",au="2",M="0",ar="-1",ad="|";var a="http://visitor.crm2.qq.com/cgi/visitorcgi/ajax/wpa_first_heart_beat.php",R="http://visitor.crm2.qq.com/cgi/visitorcgi/ajax/wpa_heart_beat.php",z="http://visitor.crm2.qq.com/cgi/visitorcgi/ajax/auto_invite.php";var ae=0,d="0",q="1",r="2",at=1;var al=10,Y=120;var G=am.document;var j=function(){if(G.domain.indexOf("crm2.qq.com")>-1){return"crm2.qq.com"}var az=am.document.domain,ax=/\.((edu)|(gov)|(com)|(org))\.cn$/,aw=/^[12]?\d?\d\.[12]?\d?\d\.[12]?\d?\d\.[12]?\d?\d$/,ay=ax.test(az)?-3:aw.test(az)?0:-2;return az.split(".").slice(ay).join(".")}();var ap=/(msie|MSIE)/.test(am.navigator.userAgent);var an=function(){return +new Date()};var u=function(ax,aw){return function(){aw.apply(ax,arguments)}};var C={log:am.console?function(aw){am.console.log(aw)}:function(){}};var H=function(aw){return aw.addEventListener?function(az,ax,ay){az.addEventListener(ax,ay)}:function(az,ax,ay){az.attachEvent(ax,ay)}}(am);var aj=function(ay,aA,aC){var ax=G.createElement("script"),aB=G.getElementsByTagName("head")[0];aB.appendChild(ax);var aw="JSONP_CALLBACK_"+an();am[aw]=function(){aC.apply(am,arguments);if(!ap||G.readyState==="complete"){setTimeout(function(){aB.removeChild(ax)},5000)}am[aw]=t};aA.cb=aw;var aD="";for(var az in aA){if(aA[az]){aD+=az+"="+encodeURIComponent(aA[az])+"&"}}ay+=(ay.indexOf("?")>-1?"&":"?")+aD;ax.src=ay};var P;(function(){P={set:function(ax,az,ay,aB,aw){if(aw){aw=new Date(an()+aw)}var aA=ax+"="+escape(az)+((aw)?"; expires="+aw.toGMTString():"")+((aB)?"; path="+aB:"")+((ay)?"; domain="+ay:"");if(aA.length<4096){am.document.cookie=aA}},get:function(ax){var aw=am.document.cookie.match(new RegExp("(^| )"+ax+"=([^;]*)(;|$)"));if(aw!=null){return unescape(aw[2])}return null},del:function(aw,ax,ay){if(this.get(aw)){am.document.cookie=aw+"="+((ay)?"; path="+ay:"")+((ax)?"; domain="+ax:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT"}},find:function(aw){return am.document.cookie.match(aw).split(",")}}})();var i;(function(){var aw=P;i=function(ax){this.blockIndex=ax};i.get=function(ax){return aw.get(ax)};i.set=function(ax,ay){return aw.set(ax,ay,j)};i.del=function(ax){return aw.del(ax,j)};i.find=function(){return aw.find.apply(aw,arguments)};i.prototype={set:function(ax,ay){return aw.set(this.blockIndex+ax,ay,j)},get:function(ax){return aw.get(this.blockIndex+ax)},del:function(ax){return aw.del(this.blockIndex+ax,j)},find:function(aB){var aA=aw.find(new RegExp(this.blockIndex+"[^=]*")),az=aA.join(";").replace(new RegExp(this.blockIndex,"g"),"").split(";");for(var ay=0,aC,ax=[];aC=az[ay++];){if(aB.test&&aB.test(aC)){ax.push(aC);continue}if(aC.indexOf(aB)>-1){ax.push(aC)}}return ax}}})();var y;(function(){y={add:function(ax){var aw=G.createElement("script");aw.src=ax;G.getElementsByTagName("head")[0].appendChild(aw)}}})();var N;(function(){N=function(){this.hash={};this.count=0;this.id=0};N.prototype={add:function(ax){var aw={data:ax,index:++this.id};this.hash[aw.index]=aw;if(this.count===0){this.first=this.last=this.cursor=aw.pre=aw.next=aw;this.count=1;return aw}aw.pre=this.last;aw.next=this.first;this.last.next=this.first.pre=aw;this.last=aw;this.count++},remove:function(aw){if(!this.hash[aw]||this.count===0){return false}if(this.count===1){this.hash[aw]=t;this.first=this.last=this.cursor=t;this.count=0;return true}var ax=this.hash[aw];if(ax===this.first){this.first=ax.next}if(ax===this.last){this.last=ax.pre}this.cursor=ax.next;ax.pre.next=ax.next;ax.next.pre=ax.pre;ax=this.hash[aw]=t;this.count--;return true},removeCurrentElem:function(){return this.cursor&&this.remove(this.cursor.index)},pre:function(){return this.cursor=this.cursor.pre},next:function(){return this.cursor=this.cursor.next},getElem:function(aw){return this.hash[aw]},getCurrentElem:function(){return this.cursor},getLength:function(){return this.count}}})();var s;(function(){var aB="run",aA="pause",ay="drop",ax=50;var aw=function(){this.circle=new N();setInterval(u(this,this.loop),16)};aw.prototype={newTask:function(aD,aE){var aC=new az(aD,aE);this.circle.add(aC);return aC},loop:function(){var aG=this.circle,aC=aG.getLength();if(aC>0){var aF=an(),aE=ax*1000,aD;while(aC>0&&an()-aF<aE){aD=aG.getCurrentElem().data;if(aD.status===aB){aD.execute();aG.next()}else{if(aD.status===aA){aG.next()}else{if(aD.status===ay){aG.removeCurrentElem()}}}aC--}}}};var az=function(aC,aD){this.fn=aC;this.gap=aD;this.status=aA;this.lastExecTime=an()};az.prototype={run:function(){this.status=aB;return this},pause:function(){this.status=aA;return this},drop:function(){this.status=ay;return this},execute:function(){if(an()-this.lastExecTime<this.gap){return false}this.fn();this.lastExecTime=an();return true},getGap:function(){return this.gap},setGap:function(aC){this.gap=aC;return this}};s=new aw()})();var g=function(aw){aw+=aw.indexOf("?")>-1?"":"?";aw+="&"+an();return new Image().src=aw};var E;(function(){E=function(ax,aw,ay){this.url="http://isdspeed.qq.com/cgi-bin/r.cgi?";this.flag="flag1="+ax+"&flag2="+aw+"&flag3="+ay;this.points=new Array(1);this.p0=an()};E.prototype={addPoint:function(aw){this.points[aw]=an()-this.p0},pushPoint:function(aw){this.points.push(an()-this.p0)},send:function(){var aw=this.url,ay=this.points;for(var ax=1,az;az=ay[ax++];){if(az){aw+=ax+"="+az}}g(aw)}}})();var L;(function(aw){var ay=aw.title,ax=s.newTask(function(){var az=aw.title;aw.title=az.substr(1,az.length)+az.substr(0,1)},Y);L={on:function(az){aw.title=az+(""+aw.title);ax.run()},off:function(){ax.pause();aw.title=ay}}})(G);var ah;(function(){var ax={};ah={newWPA:function(aA){var ay=aA.kfuin;if(!ay){return false}var az=new aw(aA);ax[ay]?ax[ay].push(az):ax[ay]=[az];return az},findInPage:function(ay){return ax[ay]!==t},getParams:function(){var aD=am.document;var aB=aD.getElementsByTagName("script");if(!aB.length||aB.length<1){return false}aB=aB[aB.length-1];var aF=aB.src.substring(aB.src.indexOf("?")+1,aB.src.length),az=decodeURIComponent(aF).split("&"),aE={};for(var aA=0,aC,ay;aC=az[aA++];){ay=aC.split("=");aE[ay[0]]=ay[1]}aE.referrer=aD.referrer.length>500?aD.referrer.substr(0,500):aD.referrer;aE.cref=am.location.href.length>500?am.location.href.substr(0,500):am.location.href;aE.pt=aD.title.length>500?aD.title.substr(0,500):aD.title;if(aE.aty==="1"){aE.kfext=aE.a}aE.kfext=aE.kfext||"";aE.dm=j;return aE}};var aw=function(ay){this.speedReport=new E();this.params=ay;this.kfuin=ay.kfuin;this.wty=ay.wty||aq;if(this.wty!==aq){return false}this.createView();this.showReport()};aw.prototype={createView:function(){var aC,az,aE=this.params,aD=this.serialize(aE),aB=parseInt(aE.type),ay;switch(aB){case 1:ay="a01";aC=102;az=24;break;case 2:ay="a02";aC=102;az=24;break;case 3:ay="a03";aC=84;az=24;break;case 4:ay="a04";aC=120;az=40;break;case 5:ay="a05";aC=126;az=42;break;case 6:ay="a06";aC=126;az=42;break;case 7:ay="a07";aC=174;az=80;break;case 8:ay="a08";aC=174;az=80;break;case 9:ay="a09";aC=230;az=92;break;case 10:ay="b01";aC=106;az=164;break;case 11:ay="b02";aC=346;az=164;break;case 12:ay="b03";aC=404;az=200;break;case 13:ay="b04";aC=138;az=320;break;case 20:ay="i01";aC=368;az=192;break;case 14:ay="c01";break}this.url="http://static.b.qq.com/account/bizqq/wpa/wpa_"+ay+".html?"+aD;this.width=aC;this.height=az;if(aB>9){this.createFloatWPA()}else{var aA=aE.containerid;this.createStaticWPA(aA)}},showReport:function(){var az=11,ay=encodeURIComponent(this.kfuin),aB=encodeURIComponent(this.params.cref),aA="http://crm2.qq.com/cgi/portalcgi/data_report.php?m="+az+"&kfuin="+ay+"&cref="+aB;g(aA)},createStaticWPA:function(az){var aC,aA=this.url,aB=this.width,ay=this.height;if(typeof az==="string"&&G.getElementById(az)){if(am.ActiveXObject){aC=G.createElement('<iframe scrolling="no" frameborder="0" width="'+aB+'" height="'+ay+'" allowtransparency="true" src="'+aA+'"></iframe>')}else{aC=G.createElement("iframe");aC.setAttribute("scrolling","no");aC.setAttribute("frameborder",0);aC.setAttribute("width",aB);aC.setAttribute("height",ay);aC.style.borderWidth="0";aC.setAttribute("allowtransparency",true);aC.setAttribute("src",aA)}G.getElementById(az).appendChild(aC);this.iframe=aC}else{var aD="iframediv"+an();G.write('<iframe id="'+aD+'" scrolling="no" frameborder="0" width="'+aB+'" height="'+ay+'" allowtransparency="true" src="'+aA+'"></iframe>');this.iframe=am.document.getElementById(aD)}},createFloatWPA:function(){var aK=am.document,aD=this.params,aH=parseInt(aD.type),ay=aK.createElement("div"),aG=this,az=this.url,aA=this.width,aL=this.height;ay.style.display="none";ay.style.width=aA;ay.style.height=aL;ay.style.position="absolute";ay.style.zIndex=88888888;var aI=aK.createElement("div");aI.id="__WPA_CLOSEBTN__";aI.style.display="block";aI.style.width=39+"px";aI.style.height=18+"px";aI.style.position="absolute";aI.style.top=(aH===20?0:6)+"px";aI.style.right=(aH===20?6:10)+"px";aI.style.cursor="pointer";aI.onclick=function(){ay.parentNode.removeChild(ay)};if(aH===20){var aB=aK.createElement("div");aB.id="__WPA_CHATBTN__";aB.style.display="block";aB.style.width=109+"px";aB.style.height=33+"px";aB.style.position="absolute";aB.style.top=142+"px";aB.style.left=244+"px";aB.style.cursor="pointer";aB.onclick=function(){ay.parentNode.removeChild(ay);var aN=encodeURIComponent(aD.kfuin),aS=encodeURIComponent(aD.ws),aT=encodeURIComponent(aD.referrer),aP=encodeURIComponent(aD.cref),aR=encodeURIComponent(aD.dm),aW=encodeURIComponent(aD.pt),aQ=aD.aty||"",aU=aD.a||"",aO=aD.iv||"",aV=aD.sv||"0",aM=aD.sp||"";am.open("http://crm2.qq.com/page/portalpage/wpa.php?uin="+aN+"&cref="+aP+"&ref="+aT+"&dm="+aR+"&pt="+aW+"&f=1&ty=1&ap=&as=&aty="+aQ+"&a="+aU+"&iv="+aO+"&sv="+aV+"&sp="+aM,"_blank","height=544, width=644,toolbar=no,scrollbars=no,menubar=no,status=no");L.off()};ay.appendChild(aB);aI.onclick=function(){ay.parentNode.removeChild(ay);L.off()}}var aE=aK.createElement("iframe");aE.id="__WPA_Iframe__";aE.frameBorder=0;aE.scrolling="no";aE.allowTransparency="true";aE.border=0;aE.width=aA;aE.height=aL;aE.src=az;this.iframe=aE;if(aE.attachEvent){aE.attachEvent("onload",aF)}else{aE.onload=function(){aC(ay,aA,aL);aE.onload=function(){}}}function aF(){aC(ay,aA,aL);aE.detachEvent("onload",aF)}function aC(aM,aO,aU){aG.speedReport.addPoint(1);aG.speedReport.send();var aW=aM.style,aS=parseInt(aD.fsty)==0?"fixed":"absolute",aP=am.ActiveXObject?true:false,aR=aP?9-((navigator.userAgent.indexOf("Trident/5.0")>-1)?0:1)-(am.XDomainRequest?0:1)-(am.XMLHttpRequest?0:1):"",aN=aK.compatMode===aK.compatMode==="BackCompat";aW.position=aS;if(parseInt(aD.fposX)==0){aW.left=8+"px";aW.right="auto";aW.marginLeft=0}else{if(parseInt(aD.fposX)==1){aW.left="50%";aW.right="auto";aW.marginLeft="-"+parseInt(aO/2)+"px"}else{aW.left="auto";aW.right=8+"px";aW.marginLeft=0}}if(parseInt(aD.fposY)==0){aW.top=8+"px";aW.bottom="auto";aW.marginTop=0}else{if(parseInt(aD.fposY)==1){aW.top="50%";aW.bottom="auto";aW.marginTop="-"+parseInt(aU/2)+"px"}else{aW.top="auto";aW.bottom=8+"px";aW.marginTop=0}}if((aP&aR<7)||aN){aW.position="absolute";if(parseInt(aD.fsty)==0){aW.marginTop=0;var aQ;if(parseInt(aD.fposY)==0){aQ=8}else{if(parseInt(aD.fposY)==1){aQ=(aV(aK)-aU)/2}else{aQ=aV(aK)-aU-8}}setInterval(function(){aW.top=aT(aK)+aQ+"px"},128)}}aW.display="block";function aT(aX){return Math.max(aX.documentElement.scrollTop,aX.body.scrollTop)}function aV(aX){return aX.compatMode=="CSS1Compat"?aX.documentElement.clientHeight:aX.body.clientHeight}}ay.appendChild(aE);ay.appendChild(aI);if(aH==11||aH==12){var aJ=aK.createElement("div");aJ.style.display="block";aJ.style.backgroundColor="#ffffff";aJ.style.filter="alpha(opacity=0)";aJ.style.opacity=0;aJ.style.width=70+"px";aJ.style.height=21+"px";aJ.style.position="absolute";if(parseInt(aD.type)==11){aJ.style.bottom=11+"px";aJ.style.right=12+"px"}if(parseInt(aD.type)==12){aJ.style.bottom=16+"px";aJ.style.right=16+"px"}aJ.style.cursor="pointer";aJ.onclick=function(){ay.parentNode.removeChild(ay)};ay.appendChild(aJ)}aK.getElementsByTagName("body")[0].appendChild(ay)},resetViewWithPvid:function(ay){this.params.sp=ay;this.iframe.src=this.url+(/&$/.test(this.url)?"":"&")+"sp="+ay},serialize:function(az){var aA="";for(var ay in az){if(az[ay]){aA+=ay+"="+encodeURIComponent(az[ay])+"&"}}return aA}}})();var ab={};var f=function(){var aC=ah.getParams();if(!aC){return false}var aB=aC.kfuin,aF=ah.findInPage(aB);if(!aF){var aw="http://tajs.qq.com/crmqq.php?uid="+aB+"&dm="+j;y.add(aw)}aC.sv=w;if(aC.wty===aq||!aC.wty){var aE=ah.newWPA(aC)}var aD=i.get(m),aA=0;var az=function(aI,aG){if(aE){aE.resetViewWithPvid(aI)}if(!aF){var aH="qq.com,pengyou.com,qzoneapp.com,nipic.com,docin.com,51zxw.net,2155.com,xd.com,yto.net.cn,c-c.com,27.cn,05wan.com,alivv.cn,gogo.com,doctorjob.com.cn,emoney.cn,m4.cn,chinaktv.net,yk988.com,bangkaow.com,wsxsp.com,55tools.com";if(aH.indexOf(j)===-1){new F(aB,aI,aG)}}};var ay={kfuin:aB,dm:j,title:G.title,url:am.location.href.split("://")[1].split("?")[0]};if(G.readyState==="complete"){ax()}else{H(am,"load",ax)}function ax(){aj(a,ay,function(aG){if(aD){az(aD,aG)}else{s.newTask(function(){aD=i.get(m);if(aD){az(aD,aG);this.drop()}if(aA++>al){this.drop()}},1000).run()}})}};var F;(function(){F=function(aw,ay,ax){this.kfuin=aw;this.pvid=ay;this.config=ax;this.genID();this.storage=new i(aw);this.monitors={master:s.newTask(u(this,this.masterMonitor),l).run(),invite:s.newTask(u(this,this.inviteMonitor),x).run()};this.heartBeat=s.newTask(u(this,this.heartBeatProcess),ao).run();this.setActive();am.onfocus=u(this,this.setActive);C.log("slave "+this.id+" launched!")};F.prototype={genID:function(){this.id="slid_"+an()%1000+"_"+Math.round(Math.random()*100)},masterMonitor:function(){if(ab[this.kfuin]){return false}C.log("monitoring mater state");var aw=this.storage.get(ai)||0,ax=an()-parseInt(aw);C.log("gap of master is "+ax);if(ax>3*I){this.recoverMaster()}},recoverMaster:function(){ab[this.kfuin]=new e(this.kfuin,this.pvid,this.config);C.log("recover master by slave "+this.id)},inviteMonitor:function(){if(this.isInvited()){this.kill()}else{if(this.isInviting()){if(this.isActive()){this.invite()}}}C.log("slave "+this.id+" monitoring invite state")},kill:function(){this.monitors.invite.drop();this.heartBeat.drop();var az=this.storage,ay=[this.id];for(var ax=0,aw;aw=ay[ax++];){az.del(aw)}C.log("slave "+this.id+" killed")},invite:function(){var aw=this.storage.get(K);var ax={wty:aq,kfuin:this.kfuin,type:A,aty:aw?(aw===M?h:O):"",a:aw||"",iv:k,fsty:T,fposX:Q,fposY:p,sv:w,sp:this.pvid,dm:j,msg:this.storage.get(S)};ah.newWPA(ax);this.storage.set(Z,au);L.on("\u3010\u60A8\u6709\u65B0\u4FE1\u606F\u3011");C.log("invited by slave "+this.id)},heartBeatProcess:function(){var ax=this.storage,aw=ax.get(av);if(!aw){ax.set(av,this.id+"|")}else{if(aw.indexOf(this.id+"|")===-1){ax.set(av,this.id+"|"+aw)}}ax.set(this.id,an())},setActive:function(){var ay=this.storage,ax=ay.get(av)||"",aw=this.id+ad;if(ax.indexOf(this.id)>-1){ax=ax.replace(aw,"")}ax+=aw;ay.set(av,ax)},isActive:function(){var aw=this.storage.get(av);if(!aw){return false}return aw.substr(0,aw.length-1).split(ad).pop()===this.id},isInvited:function(){return this.storage.get(Z)===au},isInviting:function(){return this.storage.get(Z)===b}}})();var e;(function(){e=function(aw,ay,ax){this.kfuin=aw;this.pvid=ay;this.config=ax;this.storage=new i(aw);this.genID();this.sleep=false;this.storage.set(U,this.id);this.heartBeatProcess();this.heartBeat=s.newTask(u(this,this.heartBeatProcess),I).run();this.initWithConfig();C.log("master launched!")};e.prototype={genID:function(){this.id=an()%1000+"_"+Math.round(Math.random()*100)},setInviteState:function(ax,aw,ay){if(ax===b){this.storage.set(K,aw);this.storage.set(S,ay)}this.storage.set(Z,ax)},isInvited:function(){var aw=this.storage.get(Z)===au;if(aw){this.recycle();this.isInvited=function(){return true}}return aw},initWithConfig:function(){var aw=this.config;if(aw.r!==ae){this.storage.set(ai,ar);return false}if(aw.isAuto===at){this.storage.set(S,aw.autoMsg);this.autoInviteTimer=setTimeout(u(this,function(){this.autoInvite()}),aw.autoTime*1000)}this.monitors={slave:s.newTask(u(this,this.slaveMonitor),ao).run(),server:s.newTask(u(this,this.serverMonitor),c).run(),sleep:s.newTask(u(this,this.sleepMonitor),X).run()};C.log("master inited with config")},autoInvite:function(){if(this.isInvited()){return false}var aw={kfuin:this.kfuin,uid:this.pvid},ax=this;aj(z,aw,u(this,function(ay){if(ay.r!==ae){return false}if(!ax.isInvited()){this.setInviteState(b,M,this.storage.get(S))}}))},ajustServerMonitorGap:function(aw){this.monitors.server.setGap(Math.min(Math.max(c,aw),v))},serverMonitor:function(){var ax=this.storage.get(Z);if(this.sleep){return false}var aw={kfuin:this.kfuin,uid:this.pvid};if(ax===b){aw.inviteState=q}if(ax===au){aw.inviteState=r}aj(R,aw,u(this,function(ay){if(ay.r!==ae){return false}if(ay.gap){this.ajustServerMonitorGap(ay.gap*1000)}if(ay.inviteState===d){return false}if(ay.inviteState===q){this.setInviteState(b,ay.kfext,ay.inviteMsg);return false}if(ay.inviteState===r){this.setInviteState(au)}}))},slaveMonitor:function(){if(this.isInvited()){this.monitors.slave.drop()}var aD=this.storage,aw=aD.get(av);if(!aw){return false}aw=aw.split(ad);var aB="",aA=an(),az,ax,aC;for(var ay=0;ax=aw[ay++];){C.log("monitoring slave "+ax+" state");az=aD.get(ax)||0;aC=aA-parseInt(az);C.log("gap of slave "+ax+" is "+aC);if(aC>3*ao){aD.del(ax);C.log("clear slave "+ax+" in storage")}else{aB+=ax+ad}}aD.set(av,aB)},sleepMonitor:function(){var aw=this.storage.get(av),ax=aw.substr(0,aw.length-1).split(ad).pop();if(this.sleep){if(this.activeSlave!==ax){this.activeSlave=ax;this.sleep=false;this.monitors.sleep.setGap(X)}}else{if(this.activeSlave===ax){this.sleep=true;this.monitors.sleep.setGap(n)}else{this.activeSlave=ax}}},kill:function(){ab[this.kfuin]=t;this.monitors.server.drop();this.monitors.slave.drop();this.heartBeat.drop();clearTimeout(this.autoInviteTimer);C.log("master killed")},recycle:function(){var az=this.storage,ay=[K,S];for(var ax=0,aw;aw=ay[ax++];){az.del(aw)}C.log("storage recycled")},heartBeatProcess:function(){var aw=this.storage;if(aw.get(U)!==this.id){this.kill();return false}this.storage.set(ai,an())}}})();am.BQQWPALOAD=f})(window)}window.BQQWPALOAD();